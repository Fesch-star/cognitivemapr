---
title: "Tutorial Edge and Nodelists"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tutorial-Edge-Nodelists}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Getting started

## 1: Install `cognitivemapr`

To install the cognitivemapr package, run the following code:

```{r, results='hide', warning=FALSE, message=FALSE}
install.packages("devtools", repos = "https://cloud.r-project.org/")
library(devtools)

devtools::install_github("https://github.com/Fesch-star/cognitivemapr")

# install.packages("remotes", repos = "https://cloud.r-project.org/")
# library(remotes)

# remotes::install_github("Fesch-star/cognitivemapr")
```

## 2: Introducing the functions

The cognitivemapr package contains three functions that help you
reformat existing edgelists (and nodelist) into the proper form to be
used with the functions in this package. A cognitive map is a semantic
network consisting of causal and utility relations (see Van Esch and
Snellens, 2024). Therefore, in order to use this Rpackage, the edgelist
should consist of a list of directed relations between concepts. The
nodelist contains all unique concepts in the edgelist with further
information regarding these nodes, such as their intrinsic normative
value or categorisations of the concepts (see further below). The
functions that are introduced in this tutorial cater to the various
startingpoints the data may find itself in:

1.  prepare_lists_from_edgelist: This function is used when you only
    have an edgelist. It helps you create a nodelist from this edgelist
    and reformats the edgelist to work with the other functions in the
    cognitivemapr package;

2.  align_edge_nodelist: This function is used when you have an edgelist
    and a nodelist, but these are not properly aligned yet or in the
    required format. The function (re)aligns the lists by copying the
    (normative) value of nodes from the nodelist to the edgelist, which
    is required for running the other functions in the package. You may
    need this function when you have (manually) added or changed the
    (intrinsic normative) value of some of the nodes in your nodelist.
    You do not need to align the edge and nodelist when you have
    adjusted other characteristics of the nodes, like the categorisation
    in terms of paradigms or instruments.

3.  reformat_edge_nodelist: This function is used when you have both an
    edgelist and nodelist that are already fully aligned but that are
    not in the required format. The function reformats both lists so you
    can run the other functions in this package.

The edgelists and nodelists that these functions take, already require
you to use a certain formatting (see below). To illustrate their
workings, in this tutorial simple bespoke example edgelists (and
nodelists) will be created to run the functions on.

## 3: Create a nodelist from an edgelist

In order to run the functions in this package an edgelist with
associated nodelist is needed. If your data only exists of an edgelist,
the function "prepare_lists_from_edgelist" will help you create an
accompanying nodelist from your edgelist.

The function requires your edgelist to have the following four columns
with the listed column titles, in addition any number of columns with
meta-data may be added.

1.  "from": cause concept

2.  "to": effect or utility concept

3.  "weight": number of times the relation is mentioned (can have any
    number, if left empty the function will set it to 1 by default)

4.  "edge_value": sign/value of the relation: can be 1 (positive
    relation), -1 (negative relation), or 0 (non-existent relation). If
    left empty the function will set it by default to 1 (positive).

We first create a simple dataframe/edgelist fitting these requirements
to use as an example (see Van Esch etal 2018 for a discussion on how to
derive an edgelist for CM analysis from text or obtain the data directly
from respondents).

```{r message=FALSE, warning=FALSE, results='hide'}

# create a simple single edgelist

# create a list of cause concepts (mandatory column)
from <- c("a","c","d","b") 
# creat a list of effect/utility concepts (mandatory column)
to <- c("c","d","e","d") 
# set number of times the relation occurs (mandatory column, could be left empty)
weight <- c(1,1,1,1) 
# set the value of the relation (positive, negative or non-existent effect, could be left empty)
edge_value <- c(1,-1,-1,1) 
# example of non-mandatory meta-data: date
map_date <- c("20-5-2010", "21-5-2010","22-5-2010","23-5-2010") 
# combine the data into a dataframe: the original simple edgelist
single_edgelist <- data.frame(from, to, weight, edge_value, map_date)

```

Then run the function on the example data and return the resulting
edgelist and nodelist.

```{r}
# run the function on the example data and return the resulting edge and nodelist

# run the function and return both the edge and nodelist
new_edgelist <- cognitivemapr::prepare_lists_from_edgelist(single_edgelist)[[1]]
nodelist <- cognitivemapr::prepare_lists_from_edgelist(single_edgelist)[[2]]

# show both lists
new_edgelist
nodelist


```

Reviewing the resulting edgelist and nodelist shows that the list has
been reformatted to fit the requirements of the other functions in this
package. The new nodelist contains a list of all unique concepts in the
edgelist and that for each of these concepts a unique id was created. By
default, the function assumes that all these concepts have a
positive/neutral (intrinsic normative) value (value of 1 in column
"value"). As no information was supplied about the categorisation of the
concepts in terms of paradigms or instruments, these columns are empty.

In addition, the edgelist has been reformatted to align with the
nodelist: Rather than listing the concepts, the "from" and "to" columns
list the corresponding id's for the concepts from the nodelist. The data
in the columns "weight", "edge-value" and "map_date" are left untouched.
However two extra columns were added displaying the (intrinsic
normative) value of the concepts in the from (x) and to (y) columns.

The new node and edgelist contain the minimum amount of data and the
correct formatting to use the most basic functions in the cognitivemapr
Rpackage (calculate_degrees & evaluate concepts). However, more
information is needed to make use of the full potential of the package
and to use functions like "paradigm_support", "instrument_support" and
"interactive_visual_cm". This requires a nodelist that supplies more
(categorical) information per concept. Also, some concepts may have an
intrinsic negative normative value, which necessitates adjusting the
values in the "value" columns in both the nodelist and edgelist. The
new_nodelist that the prepare_list_from_edgelist function has returned
may be used as a template to add/change this information.

## 4: Adding to or revising a nodelist

While deriving a nodelist from an edgelist is easily done with the
prepare_list_from_edgelist function, this results in an edge and
nodelist that does not contain the necessary categorisations of the
concepts in the CM to conduct a full CM analysis on. In addition, the
(normative) value of all concepts is set to positive/neutral (1) by
default, which may not be a proper reflection of the intrinsic value of
the concepts. In order to add or change this information, it must be
added to the nodelist. This may be done manually in excel by storing the
nodelist. For our example data, we will make the changes in R

```{r}

# store the new_nodelist to make amendments possible in excel

nodelist <- cognitivemapr::prepare_lists_from_edgelist(single_edgelist)[[2]]

# change the value of concept a from positive to negative
nodelist

# categorise concepts a and d as ordoliberal

# categorise concept b as a policy instrument belonging to the category "economic stimulation"


# show the amended nodelist

```

## 5: (Re) align the edge and nodelist

The second function to create edge and nodelist that are properly
formatted to use with the functions in the cognitivemapr Rpackage -
align_edge_nodelist - may be used to properly realign the edgelist with
the amended nodelist. However, this function may naturally also be used
if you started out with both an edgelist and an accompagning nodelist
that already included the proper node values and/or categorisations of
concepts in terms of paradigms and instruments.

Using the original edgelist and the new nodelist with all the proper
information, running the align_edge_nodelist function shows how both
lists are reformatting to properly work with the other functions in the
package.

```{r}

#nodelist:
id <- c(1:5)
node_name <- c("a","b","c","d","e")
eco <- c("Ordoliberal", NA, NA, NA, "Keynesian")
Int <- c("Supranational", NA, "Intergovernmental", NA, NA)
value <- c(1,1,-1,1,1)

test_nodes <- data.frame(id, node_name, eco, Int,value)

#edgelist:
from <- c(1,3,4,2)
to <- c(3,4,5,4)
weight <- c(1,1,1,1)
edge_value <- c(1,-1,-1,1)
map_id <- c(22:25)
map_date <- c("20-5-2010", "21-5-2010","22-5-2010","23-5-2010")
value.x <- c(1,-1,1,1)
value.y <- c(-1,1,1,1)

test_edges <- data.frame(from, to, weight, edge_value, map_id, map_date,value.x, value.y)
```

## Step 6: Reformat edge and nodelist

At the concept level, the output of the calc_degrees_goW function also
provides us with the first feel of the content of the CM. The table
below, for instance shows the top 10 concepts in terms of saliency and
economic paradigm (ordoliberal or keynesian) for the map of Rutte. The
table provides a first indication that the Dutch prime minister was
highly concerned about the Eurozone crisis, and was discussing several
institutional and predominantly ordoliberal measures to tackle the
crisis, while also debating the value of being pragmatic.

```{r}
{r message=FALSE, warning=FALSE, results='hide'}
# create a simple single edgelist
from <- c("a","c","d","b") # making a list of cause concepts, mandatory column
to <- c("c","d","e","d") # making a list of effect concepts, mandatory column
weight <- c(1,1,1,1) # how many times does the relation occur - if left empty the default is 1
edge_value <- c(1,-1,-1,1) # value of the relation (positive, negative or non-existent effect), - if left empty the default is 1
map_date <- c("20-5-2010", "21-5-2010","22-5-2010","23-5-2010") # non-mandatory meta-data

single_edgelist <- data.frame(from, to, weight, edge_value, map_date)


#nodelist:
id <- c(1:5)
node_name <- c("a","b","c","d","e")
eco <- c("Ordoliberal", NA, NA, NA, "Keynesian")
Int <- c("Supranational", NA, "Intergovernmental", NA, NA)
value <- c(1,1,-1,1,1)

test_nodes <- data.frame(id, node_name, eco, Int,value)

#edgelist:
from <- c(1,3,4,2)
to <- c(3,4,5,4)
weight <- c(1,1,1,1)
edge_value <- c(1,-1,-1,1)
map_id <- c(22:25)
map_date <- c("20-5-2010", "21-5-2010","22-5-2010","23-5-2010")
value.x <- c(1,-1,1,1)
value.y <- c(-1,1,1,1)

test_edges <- data.frame(from, to, weight, edge_value, map_id, map_date,value.x, value.y)

```

## Step 7: Set maximum number of iterations

By analysing the relationships between the concepts in a path, scholars
can establish if, and how concepts are peceived to be related:
positively, negatively or ambiguously (Hart 1977). For instance,
assuming that 'solving the crisis' is considered a positive goal, we can
derive from **figure 1** that 'fiscal discipline' is valued positively
as it contributes to 'solving the crisis', whereas 'wider yield spreads'
is negatively evaluated.

Running the function with the original edge and nodelist of the example
dataset reveals the maximum number of runs for this CM to be 5.

```{r}
max_runs <- cognitivemapr::set_iterations(rutte_p2_edgelist, rutte_p2_nodelist)
```

## Step 8:

Conduct a single run through the cognitive map while adjusting and
storing the changing evaluation values of the concepts using the
`evaluation_step` function. The function takes an edgelist and nodelist
as its input (if you want to add the evaluation to the dataframe with
the basic CM measures as calculated above, **be sure to use the
node_measures list**).

**NOT WORKING, FIX FUNCTION AND CONTINUE FROM HERE** **Function works
(also if I run it manually a few times in a row), but the loop does not,
I cannot get it to work**\*

```{r}
#set index to 1
index <- 1

while (index < max_runs){
  evaluate_concepts(rutte_p2_edgelist, rutte_p2_node_calc)
}
```

```{r}
# to save the changes in edgelist and nodeslist under a relevant name, use the following code when running this function

# name_period_edgelist <- evaluation_loop(edgelist, nodelist) [[1]] 

# name_period_edge_calc <- evaluation_loop(edgelist, nodelist) [[2]]

# name_period_nodecalc <- evaluation_loop(edgelist, nodelist)) [[3]] 
```

A CM analysis thus reveals both the nature, strength and complexity of
ideas as well as whether they are valued positively or negatively.

## Categorical analysis (calc_dims function)

In the case of the Eurozone crisis, scholars have identified two
competing paradigms underlying the policy debate: Keynesianism and
Ordoliberalism. The Ordoliberal paradigm is characterised by a belief in
the primacy of price stability which may be ensured by pursuing
austerity and denouncing monetary financing. In contrast, for
Keynesians, economic growth and employment take precedence and economic
stimulation is advocated to promote these goals during economic
downturns. Keynesians are also more favourable to monetary financing and
for a central bank to act as a lender of last resort (Dullien and Guérot
2012; Hall 2014). To capture the paradigmatic orthodoxy of Rutte and
Knot's belief system, all concepts in their CM were classified as either
Keynesian, Ordoliberal or neutral (Van Esch et al. 2018). The result of
this analysis shows that during the period from May 2010 and July 2012
both Rutte and Knot's belief system are more Ordoliberal than Keynesian
(see figure 2). Other types of (automated) text analysis are capable of
classifying text into broad categories in a similar fashion (Ban 2015).
The nuance of the CM analyses, however, reveals that there are also
considerable Keynesian elements in Rutte´s and Knot´s belief system,
lending support to the thesis that paradigms are not incommensurable
(Carstensen 2011b; Princen and Van Esch 2016). Moreover, due to the
standardised way the CM technique works, we are also able to compare
their scores to other leaders and conclude that internationally, the
Dutch leaders have a relatively high leaning towards the Ordoliberalism
(Van Esch et al. 2018). In a similar way, we could also analyse changes
in ideas over time, thereby fulfilling the third requirement discussed
above (Bonham, Shapiro, and Trumble 1979; Van Esch 2014).

```{r}
# plot the 10 most salient concepts
plot(rutte_p2_node_calc$w_degree [1:10], rutte_p2_node_calc$gow [1:10], xlab = "Saliency", ylab = "Weighted Goal Orientation", pch =19, frame = FALSE, text(rutte_p2_node_calc$w_degree[1:10], rutte_p2_node_calc$gow[1:10], rutte_p2_node_calc$node_name[1:10], pos = 1, cex = 0.5)) 
```

In addition, the CM technique allows scholars to distinguish between
different types of beliefs, For instance, it is also possible to
establish instrumental beliefs with CM. One way of doing this is to
inductively identify a range of possible policy-instruments relevant in
the policy area under study. For this, we used a larger set of cognitive
maps regarding the Eurozone crisis to derive seven relevant policy
measures: Stronger EU fiscal regulation, structural reforms, monetary
measures by the ECB, economic stimulation, fiscal support, financial
market measures and EMU reforms (Van Esch et al. 2018). Comparing Rutte
and Knot's maps shows that while they both lean towards an Ordoliberal
approach, they differ in terms of their instrumental beliefs: Rutte
favours implementing structural reforms and stronger fiscal regulation
over making institutional reforms to EMU, fiscal support and economic
stimulation. He does not discuss financial market measures and ECB
measures (see figure 3). Knot favours interventions by the ECB over
structural and EMU reforms and stronger EU fiscal regulation. In
addition, he shows a similar limited support for providing fiscal aid as
the PM and does not support economic stimulation or financial market
measures. These findings thus allow us to compare the extent the
instrumental ideas of Rutte and Knot influenced the Dutch management of
the Eurozone crisis (see below).

## Causal Power

(HEB ik nog niet omgezet in R code) Finally, taking full advantage of
its graphical nature, CM can be used to establish the causal strength of
the policy instruments identified in a map. For this we combine the
narrative analysis with the quantitative measures. We start by assuming
that the higher the weight of the link between cause and effect, the
stronger actors believe in its causal effect. In addition, we assume
that the larger the distance between the cause and the effect (the more
logical steps it takes to explain the relationship between instrument
and goal), the weaker the presumed causal power of the instrument (cf.
Septer, Dijkstra, and Stokman 2012; Shapiro and Bonham 1973). On the
basis of this, we propose that the causal power (CP) of an instrument on
a particular goal may be established as follows (Septer, Dijkstra, and
Stokman 2012): First, for each subsequent concept in the antecedent
path, its autonomous power (AP) may be determined following the
calculation:

AP = Ev*W*(0.9(D-1)); Whereby: Ev = Evaluation of the cause concept (-1,
0, +1) W = Weight of the relation D = Distance/steps to the effect
concept

To calculate the total causal power of a policy instrument, the
AP-scores of all concepts in the path are multiplied:

CP = AP1 \* AP2 \* ... APi

In figure 1, the causal power of the concept 'ESM' (D=2) runs via (W=2,
EV=+1) the concept 'market trust' (D=1), which in turn positively feeds
into (W=1, EV=+1) 'solving the crisis'. The causal power of ESM is thus
calculated as follows:

CP=(+1*2*(0.9 (2-1)) \* (+1*1*(0.9 (1-1)) = 1.8

Scholars have used similar analyses to derive policy preferences in the
domain of environmental and foreign policy decisions to identify
conditions under which ideas affect policies and even to run simulations
of policy making processes (Bonham, Shapiro, and Trumble 1979; Hart
1976).

## Upgraded visualisation

(draw final map function)

## (nog ergens overlap in maps? )

# Making CM available for scholars without technical skills: the CM shiny app

(HEB ik nog niet omgezet in R code)

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to
prevent printing of the R code that generated the plot.
